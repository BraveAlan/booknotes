# 1 初识Kafka

### 1.1 发布与订阅消息系统

### 1.2 Kakfa登场

Kafka 发布与订阅的消息系统，一般称为『分布式提交日志』或者『分布式流平台』

Kafka 的数据单元称为消息， 为了提高效率，消息分批次写入 Kafka，这些消息属于同一个主题和分区。

Kafka 消息通过主题(topic)分类，topic 好比数据库的表，主题可以分为若干个分区，一个分区就是一个提交日志。消息以追加方式写入分区，然后以先入先出顺序读取。因为有多个分区，所以无法保证整个 topic 范围消息顺序，但是可以保证单个分区内的顺序。 一个主题的分区可以横跨多个服务器，提供更强大的性能。

通常用『流』描述生产者移动到消费者的数据。

生产者创建消息，默认把消息均衡分布到主题的所有分区上，而不关心特定消息被写入到哪个分区。
包含同一个键的消息被写入到同一个分区。
消费者可以订阅一个或者多个主题，按照消息生成顺序读取它们，通过检查消息偏移量区分已读消息。

broker: 一个独立的 Kafka 服务器称为broker.接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。每个集群都有一个 broker 同事充当了集群控制器的角色（选举出来）。集群中一个分区从属于一个 broker，该 broker 称为分区的首领。一个分区可以分配给多个 broker，发生分区复制，为分区提供消息冗余，
如果有一个 broker 失效，其他 broker 可以接管领导权。

过期：通过设置保留策略，超时或者超过特定大小字节数，删除过期旧消息。

多集群：

- 数据类型分离
- 安全需求隔离
- 多数据中心（容灾）


为什么选择 kafka？

- 多个生产者
- 多个消费者，共享一个消息流
- 基于磁盘的数据存储
- 伸缩性
